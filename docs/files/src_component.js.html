<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/component.js - xeoengine</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">

                <h1 style="color:white;"><a href="../../">xeoEngine</a> / <a href="../../docs">API Docs</a></h1>

        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/Billboard.html">Billboard</a></li>
                                <li><a href="../classes/Boundary2D.html">Boundary2D</a></li>
                                <li><a href="../classes/Boundary3D.html">Boundary3D</a></li>
                                <li><a href="../classes/BoundaryGeometry.html">BoundaryGeometry</a></li>
                                <li><a href="../classes/BoxGeometry.html">BoxGeometry</a></li>
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/CameraControl.html">CameraControl</a></li>
                                <li><a href="../classes/CameraFlight.html">CameraFlight</a></li>
                                <li><a href="../classes/CameraPath.html">CameraPath</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/Clip.html">Clip</a></li>
                                <li><a href="../classes/Clips.html">Clips</a></li>
                                <li><a href="../classes/Collection.html">Collection</a></li>
                                <li><a href="../classes/CollectionBoundary.html">CollectionBoundary</a></li>
                                <li><a href="../classes/ColorBuf.html">ColorBuf</a></li>
                                <li><a href="../classes/ColorTarget.html">ColorTarget</a></li>
                                <li><a href="../classes/Component.html">Component</a></li>
                                <li><a href="../classes/Configs.html">Configs</a></li>
                                <li><a href="../classes/CubicBezierCurve.html">CubicBezierCurve</a></li>
                                <li><a href="../classes/Curve.html">Curve</a></li>
                                <li><a href="../classes/CylinderGeometry.html">CylinderGeometry</a></li>
                                <li><a href="../classes/DepthBuf.html">DepthBuf</a></li>
                                <li><a href="../classes/DepthTarget.html">DepthTarget</a></li>
                                <li><a href="../classes/DirLight.html">DirLight</a></li>
                                <li><a href="../classes/Entity.html">Entity</a></li>
                                <li><a href="../classes/Fresnel.html">Fresnel</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/KeyboardAxisCamera.html">KeyboardAxisCamera</a></li>
                                <li><a href="../classes/KeyboardPanCamera.html">KeyboardPanCamera</a></li>
                                <li><a href="../classes/KeyboardRotateCamera.html">KeyboardRotateCamera</a></li>
                                <li><a href="../classes/KeyboardZoomCamera.html">KeyboardZoomCamera</a></li>
                                <li><a href="../classes/LatheGeometry.html">LatheGeometry</a></li>
                                <li><a href="../classes/Layer.html">Layer</a></li>
                                <li><a href="../classes/Lights.html">Lights</a></li>
                                <li><a href="../classes/Lookat.html">Lookat</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Modes.html">Modes</a></li>
                                <li><a href="../classes/MorphTargets.html">MorphTargets</a></li>
                                <li><a href="../classes/MousePanCamera.html">MousePanCamera</a></li>
                                <li><a href="../classes/MousePickEntity.html">MousePickEntity</a></li>
                                <li><a href="../classes/MouseRotateCamera.html">MouseRotateCamera</a></li>
                                <li><a href="../classes/MouseZoomCamera.html">MouseZoomCamera</a></li>
                                <li><a href="../classes/Ortho.html">Ortho</a></li>
                                <li><a href="../classes/Path.html">Path</a></li>
                                <li><a href="../classes/PathGeometry.html">PathGeometry</a></li>
                                <li><a href="../classes/PBRMaterial.html">PBRMaterial</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PhongMaterial.html">PhongMaterial</a></li>
                                <li><a href="../classes/PlaneGeometry.html">PlaneGeometry</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/Projection.html">Projection</a></li>
                                <li><a href="../classes/QuadraticBezierCurve.html">QuadraticBezierCurve</a></li>
                                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
                                <li><a href="../classes/Reflect.html">Reflect</a></li>
                                <li><a href="../classes/Rotate.html">Rotate</a></li>
                                <li><a href="../classes/Scale.html">Scale</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/Shader.html">Shader</a></li>
                                <li><a href="../classes/ShaderParams.html">ShaderParams</a></li>
                                <li><a href="../classes/Skybox.html">Skybox</a></li>
                                <li><a href="../classes/SphereGeometry.html">SphereGeometry</a></li>
                                <li><a href="../classes/SplineCurve.html">SplineCurve</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/Stationary.html">Stationary</a></li>
                                <li><a href="../classes/Task.html">Task</a></li>
                                <li><a href="../classes/Tasks.html">Tasks</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/TorusGeometry.html">TorusGeometry</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Translate.html">Translate</a></li>
                                <li><a href="../classes/Visibility.html">Visibility</a></li>
                                <li><a href="../classes/XEO.html">XEO</a></li>
                                <li><a href="../classes/XEO.math.math.html">XEO.math.math</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/animation.html">animation</a></li>
                                <li><a href="../modules/boundaries.html">boundaries</a></li>
                                <li><a href="../modules/camera.html">camera</a></li>
                                <li><a href="../modules/canvas.html">canvas</a></li>
                                <li><a href="../modules/clipping.html">clipping</a></li>
                                <li><a href="../modules/collections.html">collections</a></li>
                                <li><a href="../modules/configs.html">configs</a></li>
                                <li><a href="../modules/controls.html">controls</a></li>
                                <li><a href="../modules/culling.html">culling</a></li>
                                <li><a href="../modules/curves.html">curves</a></li>
                                <li><a href="../modules/entities.html">entities</a></li>
                                <li><a href="../modules/geometry.html">geometry</a></li>
                                <li><a href="../modules/importing.html">importing</a></li>
                                <li><a href="../modules/input.html">input</a></li>
                                <li><a href="../modules/lighting.html">lighting</a></li>
                                <li><a href="../modules/materials.html">materials</a></li>
                                <li><a href="../modules/math.html">math</a></li>
                                <li><a href="../modules/rendering.html">rendering</a></li>
                                <li><a href="../modules/reporting.html">reporting</a></li>
                                <li><a href="../modules/shaders.html">shaders</a></li>
                                <li><a href="../modules/skyboxes.html">skyboxes</a></li>
                                <li><a href="../modules/transforms.html">transforms</a></li>
                                <li><a href="../modules/XEO.html">XEO</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <!--<div id="api-options">-->
                    <!--Show:-->
                    <!--<label for="api-show-inherited">-->
                        <!--<input type="checkbox" id="api-show-inherited" checked>-->
                        <!--Inherited-->
                    <!--</label>-->
            
                    <!--<label for="api-show-protected">-->
                        <!--<input type="checkbox" id="api-show-protected">-->
                        <!--Protected-->
                    <!--</label>-->
            
                    <!--<label for="api-show-private">-->
                        <!--<input type="checkbox" id="api-show-private">-->
                        <!--Private-->
                    <!--</label>-->
                    <!--<label for="api-show-deprecated">-->
                        <!--<input type="checkbox" id="api-show-deprecated">-->
                        <!--Deprecated-->
                    <!--</label>-->
            
                <!--</div>-->
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/component.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**

 **Component** is the base class for all xeoEngine components.

 ## Contents

 &lt;Ul&gt;
 &lt;li&gt;&lt;a href=&quot;#ids&quot;&gt;Component IDs&lt;/a&gt;&lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;#componentProps&quot;&gt;Properties&lt;/a&gt;&lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;#metadata&quot;&gt;Metadata&lt;/a&gt;&lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;#logging&quot;&gt;Logging&lt;/a&gt;&lt;/li&gt;
 &lt;li&gt;&lt;a href=&quot;#destruction&quot;&gt;Destruction&lt;/a&gt;&lt;/li&gt;
 &lt;/ul&gt;

 ## &lt;a name=&quot;ids&quot;&gt;Component IDs&lt;/a&gt;

 Every Component has an ID that&#x27;s unique within the parent {{#crossLink &quot;Scene&quot;}}{{/crossLink}}. xeoEngine generates
 the IDs automatically by default, however you can also specify them yourself. In the example below, we&#x27;re creating a
 scene comprised of {{#crossLink &quot;Scene&quot;}}{{/crossLink}}, {{#crossLink &quot;Material&quot;}}{{/crossLink}}, {{#crossLink &quot;Geometry&quot;}}{{/crossLink}} and
 {{#crossLink &quot;Entity&quot;}}{{/crossLink}} components, while letting xeoEngine generate its own ID for
 the {{#crossLink &quot;Geometry&quot;}}{{/crossLink}}:

 &#x60;&#x60;&#x60;&#x60;javascript
 // The Scene is a Component too
 var scene = new XEO.Scene({
    id: &quot;myScene&quot;
});

 var material = new XEO.PhongMaterial(scene, {
    id: &quot;myMaterial&quot;
});

 var geometry = new XEO.Geometry(scene, {
    id: &quot;myGeometry&quot;
});

 // Let xeoEngine automatically generate the ID for our Entity
 var entity = new XEO.Entity(scene, {
    material: material,
    geometry: geometry
});
 &#x60;&#x60;&#x60;&#x60;

 We can then find those components like this:

 &#x60;&#x60;&#x60;&#x60;javascript
 // Find the Scene
 var theScene = XEO.scenes[&quot;myScene&quot;];

 // Find the Material
 var theMaterial = theScene.components[&quot;myMaterial&quot;];
 &#x60;&#x60;&#x60;&#x60;

 ## &lt;a name=&quot;componentProps&quot;&gt;Properties&lt;/a&gt;

 Almost every property on a xeoEngine Component fires a change event when you update it. For example, we can subscribe
 to the {{#crossLink &quot;PhongMaterial/diffuse:event&quot;}}{{/crossLink}} event that a
 {{#crossLink &quot;Material&quot;}}{{/crossLink}} fires when its {{#crossLink &quot;PhongMaterial/diffuse:property&quot;}}{{/crossLink}}
 property is updated, like so:

 &#x60;&#x60;&#x60;&#x60;javascript
 // Bind a change callback to a property
 var handle = material.on(&quot;diffuse&quot;, function(diffuse) {
    console.log(&quot;Material diffuse color has changed to: [&quot; + diffuse[0] + &quot;, &quot; + diffuse[1] + &quot;,&quot; + diffuse[2] + &quot;]&quot;);
});

 // Change the property value, which fires the callback
 material.diffuse = [ 0.0, 0.5, 0.5 ];

 // Unsubscribe from the property change event
 material.off(handle);
 &#x60;&#x60;&#x60;&#x60;

 We can also subscribe to changes in the way components are attached to each other, since components are properties
 of other components. For example, we can subscribe to the &#x27;{{#crossLink &quot;Entity/material:event&quot;}}{{/crossLink}}&#x27; event that a
 {{#crossLink &quot;Entity&quot;}}Entity{{/crossLink}} fires when its {{#crossLink &quot;Entity/material:property&quot;}}{{/crossLink}}
 property is set to a different {{#crossLink &quot;Material&quot;}}Material{{/crossLink}}:

 &#x60;&#x60;&#x60;&#x60; javascript
 // Bind a change callback to the Entity&#x27;s Material
 entity1.on(&quot;material&quot;, function(material) {
    console.log(&quot;Entity&#x27;s Material has changed to: &quot; + material.id);
});

 // Now replace that Material with another
 entity1.material = new XEO.PhongMaterial({
    id: &quot;myOtherMaterial&quot;,
    diffuse: [ 0.3, 0.3, 0.6 ]
    //..
});
 &#x60;&#x60;&#x60;&#x60;

 ## &lt;a name=&quot;metadata&quot;&gt;Metadata&lt;/a&gt;

 You can set optional **metadata** on your Components, which can be anything you like. These are intended
 to help manage your components within your application code or content pipeline. You could use metadata to attach
 authoring or version information, like this:

 &#x60;&#x60;&#x60;&#x60;javascript
 // Scene with authoring metadata
 var scene = new XEO.Scene({
    id: &quot;myScene&quot;,
    meta: {
        title: &quot;My awesome 3D scene&quot;,
        author: &quot;@xeolabs&quot;,
        date: &quot;February 13 2015&quot;
    }
});

 // Material with descriptive metadata
 var material = new XEO.PhongMaterial(scene, {
    id: &quot;myMaterial&quot;,
    diffuse: [1, 0, 0],
    meta: {
        description: &quot;Bright red color with no textures&quot;,
        version: &quot;0.1&quot;,
        foo: &quot;bar&quot;
    }
});
 &#x60;&#x60;&#x60;&#x60;

 As with all properties, you can subscribe and change the metadata like this:

 &#x60;&#x60;&#x60;&#x60;javascript
 // Subscribe to changes to the Material&#x27;s metadata
 material.on(&quot;meta&quot;, function(value) {
    console.log(&quot;Metadata changed: &quot; + JSON.stringify(value));
});

 // Change the Material&#x27;s metadata, firing our change handler
 material.meta = {
    description: &quot;Bright red color with no textures&quot;,
    version: &quot;0.2&quot;,
    foo: &quot;baz&quot;
};
 &#x60;&#x60;&#x60;&#x60;

 ## &lt;a name=&quot;logging&quot;&gt;Logging&lt;/a&gt;

 Components have methods to log ID-prefixed messages to the JavaScript console:

 &#x60;&#x60;&#x60;&#x60;javascript
 material.log(&quot;Everything is fine, situation normal.&quot;);
 material.warn(&quot;Wait, whats that red light?&quot;);
 material.error(&quot;Aw, snap!&quot;);
 &#x60;&#x60;&#x60;&#x60;

 The logged messages will look like this in the console:

 &#x60;&#x60;&#x60;&#x60;text
 [LOG]   myMaterial: Everything is fine, situation normal.
 [WARN]  myMaterial: Wait, whats that red light..
 [ERROR] myMaterial: Aw, snap!
 &#x60;&#x60;&#x60;&#x60;

 ## &lt;a name=&quot;destruction&quot;&gt;Destruction&lt;/a&gt;

 Get notification of destruction directly on the Components:

 &#x60;&#x60;&#x60;&#x60;javascript
 material.on(&quot;destroyed&quot;, function() {
    this.log(&quot;Component was destroyed: &quot; + this.id);
});
 &#x60;&#x60;&#x60;&#x60;

 Or get notification of destruction of any Component within its {{#crossLink &quot;Scene&quot;}}{{/crossLink}}, indiscriminately:

 &#x60;&#x60;&#x60;&#x60;javascript
 scene.on(&quot;componentDestroyed&quot;, function(component) {
    this.log(&quot;Component was destroyed: &quot; + component.id);
});
 &#x60;&#x60;&#x60;&#x60;

 Then destroy a component like this:

 &#x60;&#x60;&#x60;&#x60;javascript
 material.destroy();
 &#x60;&#x60;&#x60;&#x60;

 Other Components that are linked to it will fall back on a default of some sort. For example, any
 {{#crossLink &quot;Entity&quot;}}Entities{{/crossLink}} that were linked to our {{#crossLink &quot;Material&quot;}}{{/crossLink}}
 will then automatically link to the {{#crossLink &quot;Scene&quot;}}Scene&#x27;s{{/crossLink}} default {{#crossLink &quot;Scene/material:property&quot;}}{{/crossLink}}.

 @class Component
 @module XEO
 @constructor
 @param [scene] {Scene} Parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} - creates this Component
 within the default {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} when omitted.
 @param [cfg] {*} DepthBuf configuration
 @param [cfg.id] {String} Optional ID, unique among all components in the parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}, generated automatically when omitted.
 @param [cfg.meta] {String:Object} Optional map of user-defined metadata to attach to this Component.
 @param [cfg.isDefault] {Boolean} Set true when this is one of xeoEngine&#x27;s default components.
 */
(function () {

    &quot;use strict&quot;;

    XEO.Component = Class.extend({

        __init: function () {


            var cfg = {};

            var arg1 = arguments[0];
            var arg2 = arguments[1];


            /**
             The parent {{#crossLink &quot;Scene&quot;}}{{/crossLink}} that contains this Component.

             @property scene
             @type {Scene}
             @final
             */
            this.scene = null;

            if (this.type === &quot;XEO.Scene&quot;) {

                this.scene = this;

                if (arg1) {
                    cfg = arg1;
                }

            } else {

                if (arg1) {

                    if (arg1.type === &quot;XEO.Scene&quot;) {

                        this.scene = arg1;

                        if (arg2) {
                            cfg = arg2;
                        }

                    } else {

                        // Create this component within the default XEO Scene

                        this.scene = XEO.scene;

                        cfg = arg1;
                    }
                } else {

                    // Create this component within the default XEO Scene

                    this.scene = XEO.scene;
                }

                this._renderer = this.scene._renderer;
            }

            /**
             Arbitrary, user-defined metadata on this component.

             @property metadata
             @type Object
             */
            this.meta = cfg.meta || {};

            /**
             Indicates whether this is one of the {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}&#x27;s built-in Components.

             @property isDefault
             @type Boolean
             */
            this.isDefault = cfg.isDefault;

            /**
             Unique ID for this Component within its parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}.

             @property id
             @type String
             @final
             */
            this.id = cfg.id;

            /**
             True as soon as this Component has been destroyed

             @property destroyed
             @type Boolean
             */
            this.destroyed = false;

            // Child components keyed to arbitrary names
            this._children = {};

            // Subscriptions for child component destructions
            this._childDestroySubs = {};

            // Subscriptions to child components needing recompilation
            this._childDirtySubs = {};

            // Pub/sub
            this._handleMap = new XEO.utils.Map(); // Subscription handle pool
            this._handleEvents = {}; // Subscription handles mapped to event names
            this._eventSubs = {}; // Event names mapped to subscribers

            this._events = {}; // Maps locations to publications

            this._eventCallDepth = 0; // Helps us catch stack overflows from recursive events

            this._sharedComponents = {};

            if (this.scene &amp;&amp; this.type !== &quot;XEO.Scene&quot;) { // HACK: Don&#x27;t add scene to itself

                // Register this component on its scene
                // Assigns this component an automatic ID if not yet assigned

                this.scene._addComponent(this);
            }

            this._updateScheduled = false;

            // Initialize this component using the configs

            if (this._init) {
                this._init(cfg);
            }
        },

        /**
         JavaScript class name for this Component.

         This is used when &lt;a href=&quot;Scene.html#savingAndLoading&quot;&gt;loading Scenes from JSON&lt;/a&gt;, and is included in the JSON
         representation of this Component, so that this class may be instantiated when loading it from the JSON representation.

         For example: &quot;XEO.AmbientLight&quot;, &quot;XEO.ColorTarget&quot;, &quot;XEO.Lights&quot; etc.

         @property type
         @type String
         @final
         */
        type: &quot;XEO.Component&quot;,

        /**
         An array of strings that indicates the types within this component&#x27;s inheritance hierarchy.

         For example, if this component is a {{#crossLink &quot;Rotate&quot;}}{{/crossLink}}, which
         extends {{#crossLink &quot;Transform&quot;}}{{/crossLink}}, which in turn extends {{#crossLink &quot;Component&quot;}}{{/crossLink}},
         then this property will have the value:

         &#x60;&#x60;&#x60;&#x60;json
         [&quot;XEO.Component&quot;, &quot;XEO.Transform&quot;, &quot;XEO.Rotate&quot;]
         &#x60;&#x60;&#x60;&#x60;

         Note that the chain is ordered downwards in the hierarchy, ie. from super-class down to sub-class.

         @property types
         @type {Array of String}
         @final
         */
        types: [&quot;XEO.Component&quot;],

        /**
         Tests if this component is of the given type, or is a subclass of the given type.

         The type may be given as either a string or a component constructor.

         This method works by walking up the inheritance type chain, which this component provides in
         property {{#crossLink &quot;Component/types:property&quot;}}{{/crossLink}}, returning true as soon as one of the type strings in
         the chain matches the given type, of false if none match.

         #### Examples:

         &#x60;&#x60;&#x60;&#x60;javascript
         var myRotate = new XEO.Rotate({ ... });

         myRotate.isType(XEO.Component); // Returns true for all XEO components
         myRotate.isType(&quot;XEO.Component&quot;); // Returns true for all XEO components
         myRotate.isType(XEO.Rotate); // Returns true
         myRotate.isType(XEO.Transform); // Returns true
         myRotate.isType(&quot;XEO.Transform&quot;); // Returns true
         myRotate.isType(XEO.Entity); // Returns false, because XEO.Rotate does not (even indirectly) extend XEO.Entity
         &#x60;&#x60;&#x60;&#x60;

         @method isType
         @param  {String|Function} type Component type to compare with, eg &quot;XEO.PhongMaterial&quot;, or a XEO component constructor.
         @returns {Boolean} True if this component is of given type or is subclass of the given type.
         */
        isType: function (type) {

            if (!XEO._isString(type)) {

                // Handle constructor arg

                type = type.type;
                if (!type) {
                    return false;
                }
            }

            var types = this.types;

            if (!types) {
                return false;
            }

            for (var i = types.length - 1; i &gt;= 0; i--) {
                if (types[i] === type) {
                    return true;
                }
            }

            return false;
        },

        /**
         * Initializes this component
         * @param cfg
         * @private
         */
        _init: function (cfg) {
        },

        /**
         * Fires an event on this component.
         *
         * Notifies existing subscribers to the event, retains the event to give to
         * any subsequent notifications on that location as they are made.
         *
         * @method fire
         * @param {String} event The event type name
         * @param {Object} value The event parameters
         * @param {Boolean} [forget=false] When true, does not retain for subsequent subscribers
         */
        fire: function (event, value, forget) {

            if (forget !== true) {
                this._events[event] = value; // Save notification
            }

            var subs = this._eventSubs[event];
            var sub;

            if (subs) { // Notify subscriptions

                for (var handle in subs) {
                    if (subs.hasOwnProperty(handle)) {

                        sub = subs[handle];

                        this._eventCallDepth++;

                        if (this._eventCallDepth &lt; 300) {
                            sub.callback.call(sub.scope, value);
                        } else {
                            this.error(&quot;fire: potential stack overflow from recursive event &#x27;&quot; + event + &quot;&#x27; - dropping this event&quot;);
                        }

                        this._eventCallDepth--;
                    }
                }
            }
        },

        /**
         * Subscribes to an event on this component.
         *
         * The callback is be called with this component as scope.
         *
         * @method on
         * @param {String} event The event
         * @param {Function} callback Called fired on the event
         * @param {Object} [scope=this] Scope for the callback
         * @return {String} Handle to the subscription, which may be used to unsubscribe with {@link #off}.
         */
        on: function (event, callback, scope) {
            var subs = this._eventSubs[event];
            if (!subs) {
                subs = {};
                this._eventSubs[event] = subs;
            }
            var handle = this._handleMap.addItem(); // Create unique handle
            subs[handle] = {
                callback: callback,
                scope: scope || this
            };
            this._handleEvents[handle] = event;
            var value = this._events[event];
            if (value) { // A publication exists, notify callback immediately
                callback.call(scope || this, value);
            }
            return handle;
        },

        /**
         * Cancels an event subscription that was previously made with {{#crossLink &quot;Component/on:method&quot;}}{{/crossLink}} or
         * {{#crossLink &quot;Component/once:method&quot;}}{{/crossLink}}.
         *
         * @method off
         * @param {String} handle Publication handle
         */
        off: function (handle) {
            if (handle === undefined || handle === null) {
                return;
            }
            var event = this._handleEvents[handle];
            if (event) {
                delete this._handleEvents[handle];
                var locSubs = this._eventSubs[event];
                if (locSubs) {
                    delete locSubs[handle];
                }
                this._handleMap.removeItem(handle); // Release handle
            }
        },

        /**
         * Subscribes to the next occurrence of the given event, then un-subscribes as soon as the event is handled.
         *
         * This is equivalent to calling {{#crossLink &quot;Component/on:method&quot;}}{{/crossLink}}, and then calling
         * {{#crossLink &quot;Component/off:method&quot;}}{{/crossLink}} inside the callback function.
         *
         * @method once
         * @param {String} event Data event to listen to
         * @param {Function(data)} callback Called when fresh data is available at the event
         * @param {Object} [scope=this] Scope for the callback
         */
        once: function (event, callback, scope) {
            var self = this;
            var handle = this.on(event,
                function (value) {
                    self.off(handle);
                    callback(value);
                },
                scope);
        },

        /**
         * Logs a console debugging message for this component.
         *
         * The console message will have this format: *&#x60;&#x60;&#x60;&#x60;[LOG] [&lt;component type&gt; &lt;component id&gt;: &lt;message&gt;&#x60;&#x60;&#x60;&#x60;*
         *
         * Also fires the message as a {{#crossLink &quot;Scene/log:event&quot;}}{{/crossLink}} event on the
         * parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}.
         *
         * @method log
         * @param {String} message The message to log
         */
        log: function (message) {

            message = &quot;[LOG]&quot; + this._message(message);

            window.console.log(message);

            this.scene.fire(&quot;log&quot;, message);
        },

        _message: function (message) {
            // return &quot; [&quot; + (this.type.indexOf(&quot;XEO.&quot;) &gt; -1 ? this.type.substring(4) : this.type) + &quot; &quot; + XEO._inQuotes(this.id) + &quot;]: &quot; + message;
            return &quot; [&quot; + this.type + &quot; &quot; + XEO._inQuotes(this.id) + &quot;]: &quot; + message;
        },

        /**
         * Logs a warning for this component to the JavaScript console.
         *
         * The console message will have this format: *&#x60;&#x60;&#x60;&#x60;[WARN] [&lt;component type&gt; =&lt;component id&gt;: &lt;message&gt;&#x60;&#x60;&#x60;&#x60;*
         *
         * Also fires the message as a {{#crossLink &quot;Scene/warn:event&quot;}}{{/crossLink}} event on the
         * parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}.
         *
         * @method warn
         * @param {String} message The message to log
         */
        warn: function (message) {

            message = &quot;[WARN]&quot; + this._message(message);

            window.console.warn(message);

            this.scene.fire(&quot;warn&quot;, message);
        },

        /**
         * Logs an error for this component to the JavaScript console.
         *
         * The console message will have this format: *&#x60;&#x60;&#x60;&#x60;[ERROR] [&lt;component type&gt; =&lt;component id&gt;: &lt;message&gt;&#x60;&#x60;&#x60;&#x60;*
         *
         * Also fires the message as an {{#crossLink &quot;Scene/error:event&quot;}}{{/crossLink}} event on the
         * parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}.
         *
         * @method error
         * @param {String} message The message to log
         */
        error: function (message) {

            message = &quot;[ERROR]&quot; + this._message(message);

            window.console.error(message);

            this.scene.fire(&quot;error&quot;, message);
        },

        /**
         * Creates a clone of this component.
         *
         * The clone will have the same properties as the original, except where
         * overridden in the given optional configs.
         *
         * The clone will share (by reference) the components of the original, unless overridden.
         *
         * For example, if this component is an {{#crossLink &quot;Entity&quot;}}{{/crossLink}}, then the clone
         * will be attached to the **same** instances of {{#crossLink &quot;PhoneMaterial&quot;}}{{/crossLink}},
         * {{#crossLink &quot;Camera&quot;}}{{/crossLink}} etc as this component, unless it supplies its own
         * instances for those via the configs.
         *
         * @param {*} [cfg] Configurations to override.
         * @returns {Component} The shallow clone
         */
        clone: function (cfg) {

            if (this.destroyed) {
                this.error(&quot;Clone failed - component has been destroyed&quot;);
                return;
            }

            cfg = cfg || {};

            var json = this.json;

            delete json.id;

            return new this.constructor(this.scene, XEO._apply(cfg, json));
        },

        /**
         * Adds a child component to this.
         * When component not given, attaches the scene&#x27;s default instance for the given name (if any).
         * Publishes the new child component on this component, keyed to the given name.
         *
         * @param {String} [expectedType] Optional expected type of base type of the child; when supplied, will
         * cause an exception if the given child is not the same type or a subtype of this.
         * @param {String} name component name
         * @param {Component} child The component
         * @param {Boolean} [useDefault=true]
         * @param {Function} [onAdded] Optional callback called before event is fired
         * @param {Function} [onAddedScope] Optional scope for callback
         * @private
         */
        _setChild: function (expectedType, name, child, useDefault, onAdded, onAddedScope) {

            if (!child &amp;&amp; useDefault !== false) {

                // No child given, fall back on default component class for the given name

                child = this.scene[name];

                //if (!child) {
                //    this.error(&quot;No default component for name &#x27;&quot; + name + &quot;&#x27;&quot;);
                //    return;
                //}

            } else {

                // Child ID or instance given

                // Both numeric and string IDs are supported

                if (child &amp;&amp; XEO._isNumeric(child) || XEO._isString(child)) {

                    // Child ID given

                    var id = child;

                    child = this.scene.components[id];

                    if (!child) {

                        // Quote string IDs in errors

                        this.error(&quot;Component not found: &quot; + XEO._inQuotes(id));
                        return;
                    }
                }
            }

            if (child) {

                if (child.scene.id !== this.scene.id) {
                    this.error(&quot;Not in same scene: &quot; + child.type + &quot; &quot; + XEO._inQuotes(child.id));
                    return;
                }

                if (expectedType) {

                    if (!child.isType(expectedType)) {

                        // Attempt to fall back on default component class for the given name

                        child = this.scene[name];

                        if (!child) {

                            this.error(&quot;Expected a &quot; + expectedType + &quot; type or subtype: &quot; + child.type + &quot; &quot; + XEO._inQuotes(child.id));

                            return;

                        } else {
                            this.error(&quot;Expected a &quot; + expectedType + &quot; type or subtype: &quot; + child.type + &quot; &quot;
                                + XEO._inQuotes(child.id) + &quot; (recovering by adding Scene&#x27;s default &quot; + expectedType + &quot; instance instead)&quot;);

                        }
                    }
                }
            }

            var oldChild = this._children[name];

            if (oldChild) {

                // Child of given name already attached

                if (child &amp;&amp; oldChild.id === child.id) {

                    // Reject attempt to reattach same child
                    return;
                }

                // Unsubscribe from old child&#x27;s destruction

                oldChild.off(this._childDestroySubs[name]);
                oldChild.off(this._childDirtySubs[name]);
            }

            if (child) {

                // Set and publish the new child on this component

                this._children[name] = child;

                // Bind destruct listener to new child to remove it
                // from this component when destroyed

                this._childDestroySubs[name] = child.on(&quot;destroyed&quot;,
                    function () {
                        this._childDestroyed(name, child);
                    }, this);

                this._childDirtySubs[name] = child.on(&quot;dirty&quot;, this._childDirty, this);

            } else {
                delete this._children[name];
            }

            if (onAdded) {

                // Fire optional callback so caller can do stuff
                // before the change event is fired below

                onAddedScope ? onAdded.call(onAddedScope, child) : onAdded();
            }

            this.fire(&quot;dirty&quot;, this);

            this.fire(name, child);

            return child;
        },

        // Callbacks as members to reduce memory churn

        /**
         * @private
         */
        _childDestroyed: function (name, child) {

            // Child destroyed
            delete this._children[name];

            // Try to fall back on default child
            var defaultComponent = this.scene[name];

            if (!defaultComponent || child.id === defaultComponent.id) {

                // Old child was the default,
                // so publish null child and bail

                this.fire(name, null);

                return;
            }

            // Set default child
            this._setChild(null, name, defaultComponent);
        },

        /**
         * @private
         */
        _childDirty: function () {
            this.fire(&quot;dirty&quot;, this);
        },

        /**
         * Convenience method for creating a Component within this Component&#x27;s {{#crossLink &quot;Scene&quot;}}{{/crossLink}}.
         *
         * You would typically use this method to conveniently instantiate components that you&#x27;d want to
         * share (ie. &quot;instance&quot;) among your {{#crossLink &quot;Entity&quot;}}Entities{{/crossLink}}.
         *
         * The method is given a component type and configuration, like so:
         *
         * &#x60;&#x60;&#x60;&#x60;javascript
         * var material = myComponent.create(XEO.PhongMaterial, {
         *      diffuse: [1,0,0],
         *      specular: [1,1,0]
         * });
         * &#x60;&#x60;&#x60;&#x60;
         *
         * The first time you call this method for the given &#x60;&#x60;&#x60;&#x60;type&#x60;&#x60;&#x60;&#x60; and &#x60;&#x60;&#x60;&#x60;instanceId&#x60;&#x60;&#x60;&#x60;, this method will create the
         * {{#crossLink &quot;PhongMaterial&quot;}}{{/crossLink}}, passing the given  attributes to the component&#x27;s constructor.
         *
         * If you call this method again, specifying the same &#x60;&#x60;&#x60;&#x60;type&#x60;&#x60;&#x60;&#x60; and &#x60;&#x60;&#x60;&#x60;instanceId&#x60;&#x60;&#x60;&#x60;, the method will return the same
         * component instance that it returned the first time, and will ignore the attributes:
         *
         * &#x60;&#x60;&#x60;&#x60;javascript
         * var material2 = component.create(XEO.PhongMaterial, &quot;myMaterial&quot;, { specular: [1,1,0] });
         * &#x60;&#x60;&#x60;&#x60;
         *
         * Each time you call this method with the same &#x60;&#x60;&#x60;&#x60;type&#x60;&#x60;&#x60;&#x60; and &#x60;&#x60;&#x60;&#x60;instanceId&#x60;&#x60;&#x60;&#x60;, the Scene will internally increment a
         * reference count for the component instance. You can release the shared component instance with a call to
         * {{#crossLink &quot;Scene/putSharedComponent:method&quot;}}{{/crossLink}}, and once you have released it as many
         * times as you got it, the Scene will destroy the component.
         *
         * @method create
         * @param {String} type Component type - either a string like &quot;XEO.PhongMaterial&quot; or the actual
         * constructor function, ie. XEO.PhongMaterial.
         * @param {*} [cfg] Configuration for the component instance - only used if this is the first time you are getting
         * the component, ignored when reusing an existing instance.
         * @param {String|Number} [instanceId] Identifies the shared component instance. Note that this is not used as the ID of the
         * component - you can specify the component ID in the &#x60;&#x60;&#x60;&#x60;cfg&#x60;&#x60;&#x60;&#x60; parameter.
         * @returns {*}
         */
        create: function (type, cfg, instanceId) {

            // Create or reuse the component via this component&#x27;s scene;
            // reusing if instanceId given, else getting unique instance otherwise

            var component = this.scene._getSharedComponent(type, cfg, instanceId);

            if (component) {

                // Register component on this component so that we can
                // automatically destroy it when we destroy this component

                if (!this._sharedComponents[component.id]) {
                    this._sharedComponents[component.id] = component;
                }
            }

            component.on(&quot;destroyed&quot;, function () {

                // If the component is explicitly destroyed, ie. by calling
                // its #destroy method, then deregister it so we don&#x27;t try
                // to destroy it a second time when we destroy this component

                delete this._sharedComponents[component.id];
            }, this);

            return component;
        },

        /**
         * Protected method, called by sub-classes to queue a call to _update().
         * @protected
         */
        _scheduleUpdate: function () {

            if (!this._updateScheduled) {

                this._updateScheduled = true;
                this._buildScheduled = true;

                XEO.scheduleTask(this._doUpdate, this);
            }
        }
        ,

        /**
         * @private
         */
        _doUpdate: function () {

            if (this._updateScheduled) {

                if (this._buildScheduled) {

                    if (this._build) {
                        this._build();
                    }

                    this._buildScheduled = false;
                }

                if (this._update) {
                    this._update();
                }

                this._updateScheduled = false;
            }
        }
        ,

        /**
         * Optional virtual template method, normally implemented
         * by sub-classes to generate some data before _update gets
         * callled
         *
         * @protected
         */
        _build: null,

        /**
         * Protected virtual template method, optionally implemented
         * by sub-classes to perform a scheduled task.
         *
         * @protected
         */
        _update: null,

        /**
         * Protected template method, implemented by sub-classes to compile
         * their state into their Scene&#x27;s XEO.renderer.Renderer.
         *
         * @protected
         */
        _compile: function () {
        }
        ,

        _props: {

            /**
             * JSON object containing the state of this Component.
             *
             * @property json
             * @type JSON
             * @final
             */
            json: {

                get: function () {

                    // Return component&#x27;s type-specific properties,
                    // augmented with the base component properties

                    var json = {
                        type: this.type,
                        id: this.id // Only output user-defined IDs
                    };

                    if (!XEO._isEmptyObject(this.meta)) {
                        json.meta = this.meta;
                    }

                    return this._getJSON ? XEO._apply(this._getJSON(), json) : json;
                }
            }
            ,

            /**
             * String containing the serialized JSON state of this Component.
             *
             * @property string
             * @type String
             * @final
             */
            string: {

                get: function () {
                    return JSON.stringify(this.json, &quot;\n&quot;, 4);
                }
            }
            ,

            /**
             * Experimental: string containing a JavaScript expression that would instantiate this Component.
             *
             * @property string
             * @type String
             * @final
             */
            js: {

                get: function () {
                    var json = this.json;
                    delete json.id;
                    var str = JSON.stringify(json, &quot;\n&quot;, 4);
                    return &quot;new &quot; + this.type + &quot;(&quot; + str + &quot;);&quot;;
                }
            }
        }
        ,

        /**
         * Destroys this component.
         *
         * Fires a {{#crossLink &quot;Component/destroyed:event&quot;}}{{/crossLink}} event on this Component.
         *
         * Automatically disassociates this component from other components, causing them to fall back on any
         * defaults that this component overrode on them.
         *
         * TODO: describe effect with respect to #create
         *
         * @method destroy
         */
        destroy: function () {

            // Unsubscribe from child components

            var component;

            for (var name in this._children) {
                if (this._children.hasOwnProperty(name)) {

                    component = this._children[name];

                    component.off(this._childDestroySubs[name]);
                    component.off(this._childDirtySubs[name]);
                }
            }

            // Release components created with #create

            for (var id in this._sharedComponents) {
                if (this._sharedComponents.hasOwnProperty(id)) {

                    component = this._sharedComponents[id];

                    delete this._sharedComponents[id];

                    this.scene._putSharedComponent(component);
                }
            }

            // Execute subclass behaviour

            if (this._destroy) {
                this._destroy();
            }

            /**
             * Fired when this Component is destroyed.
             * @event destroyed
             */

            this.fire(&quot;destroyed&quot;, this.destroyed = true);
        }
        ,

        /**
         * Protected template method, implemented by sub-classes
         * to clean up just before the component is destroyed.
         *
         * @protected
         */
        _destroy: function () {
        }
    })
    ;

})
();

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
